<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Implement LRU Cache in JavaScript | TaoAlpha's Blog</title><meta name="description" content="This is one step for my whole implement-everything-in-javascript journey."><meta name="viewport" content="width=device-width, initial-scale=1"><!-- open graph part--><meta property="og:title" content="Implement LRU Cache in JavaScript | TaoAlpha's Blog"><meta property="og:description" content="This is one step for my whole implement-everything-in-javascript journey."><meta property="og:url" content="undefined"><meta property="og:image" content="http://taoalpha.github.io/images/newblog.jpg"><meta property="og:type" content="website"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.6.0/hint.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"><link rel="short icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/default.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="TaoAlpha's Blog" type="application/atom+xml">
<link rel="alternate" href="/blog/rss2.xml" title="TaoAlpha's Blog" type="application/rss+xml">
</head><body class="post"><aside class="home-menu"><nav class="home-icon-con upside"><a href="/blog/" class="home-menu-icon brand">涛</a><a href="/blog/timeline" class="home-menu-icon"><i class="fas fa-map-marker-alt"></i></a><a aria-label="Click to take you to the search box." class="home-menu-icon search-trigger hint--right"><i class="fas fa-search"></i></a><a href="javascript:;" title="Contact Me" class="home-menu-icon follow">+</a><div class="home-contact hidden"><a href="https://facebook.com/zzgary/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/facebook-32.png" alt="facebook"></a><a href="https://github.com/taoalpha/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/github-32.png" alt="github"></a><a href="https://taoalpha.github.io" target="something"><img src="https://cdn3.iconfinder.com/data/icons/colore-sociale/32/mewally_32x32.png" alt="portfolio"></a><a href="https://douban.com/people/129154019" target="something"><img src="https://img3.doubanio.com/favicon.ico" alt="douban"></a></div></nav><nav class="home-icon-con downside"><a href="/blog/rss2.xml" class="home-menu-icon rss"><i class="fas fa-rss"></i></a><a href="/blog/about/" class="home-menu-icon"><i class="fas fa-smile"></i></a><span id="dark-mode" class="home-menu-icon hidden"><i class="fas fa-adjust"></i></span></nav></aside><div class="stars"></div><div class="twinkling"></div><div id="progress-bar" class="hidden"><span class="bg"></span></div><article id="content"><div class="main"><section class="entry"><h1 class="entry-title">Implement LRU Cache in JavaScript</h1><div class="meta-top"><a href="https://taoalpha.github.io"><div style="display:inline-block;" class="avatar"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&amp;s=40" alt="100"></div><span>TaoAlpha</span></a><span>2015-11-03</span><span class="wordage">5279 words</span><span class="readspeed">16 minutes to read</span></div><div class="entry-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>LRU which is short for least recently used is a popular algorithm in cache. The basic idea is always put your items in order of used time, and when you insert new item into the fullfilled chache,remove the least recently used item in your memory.</p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="O-n"><a href="#O-n" class="headerlink" title="O(n)"></a>O(n)</h3><p>At first, I plan to use a hashtable and a list with all keys to achieve it, and I did, but the time cost apparently too large: O(n) since I have to search the list to get the key and then get the value from the hashtable.</p>
<p>Here is the code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constructor</span></span><br><span class="line"><span class="keyword">var</span> LRUCache = <span class="function"><span class="keyword">function</span>(<span class="params">capacity</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// save all key-value pairs in this hashtable</span></span><br><span class="line">  <span class="keyword">this</span>.bucket = &#123;&#125;</span><br><span class="line">  <span class="comment">// save all keys in the stack with the order of last used time</span></span><br><span class="line">  <span class="keyword">this</span>.keys = []</span><br><span class="line">  <span class="keyword">this</span>.capacity = capacity</span><br><span class="line">  <span class="keyword">this</span>.length = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRUCache.prototype.updateKey = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// update the position of this key in keys </span></span><br><span class="line">  <span class="keyword">var</span> keyIndex = <span class="keyword">this</span>.keys.indexOf(key)</span><br><span class="line">  <span class="keyword">this</span>.keys[keyIndex] = <span class="literal">undefined</span></span><br><span class="line">  <span class="comment">// update the key to the head of the stack</span></span><br><span class="line">  <span class="keyword">this</span>.keys.push(key)</span><br><span class="line">&#125;</span><br><span class="line">LRUCache.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.bucket.hasOwnProperty(key))&#123;</span><br><span class="line">    <span class="keyword">this</span>.updateKey(key)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.bucket[key]</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRUCache.prototype.set = <span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.capacity &lt;= <span class="number">0</span>)&#123;<span class="built_in">console</span>.log(<span class="string">"no memory to save 1 item"</span>);<span class="keyword">return</span>&#125;</span><br><span class="line">  <span class="comment">// update exist item </span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.bucket.hasOwnProperty(key))&#123;</span><br><span class="line">    <span class="keyword">this</span>.bucket[key] = value</span><br><span class="line">    <span class="keyword">this</span>.updateKey(key)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// if the bucket is fullfilled, remove the least recently used item</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.length &gt;= <span class="keyword">this</span>.capacity)&#123;</span><br><span class="line">    <span class="keyword">var</span> dKey = <span class="keyword">this</span>.keys.shift()</span><br><span class="line">    <span class="keyword">while</span>(!dKey)&#123;</span><br><span class="line">      <span class="comment">// if the dKey is undefined, shift() again</span></span><br><span class="line">      dKey = <span class="keyword">this</span>.keys.shift()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.bucket[dKey]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add new item and update the length</span></span><br><span class="line">  <span class="keyword">this</span>.bucket[key] = value</span><br><span class="line">  <span class="keyword">this</span>.keys.push(key)</span><br><span class="line">  <span class="keyword">this</span>.length ++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Can we do better ? Definitely. We can optimize it to O(1) if we use double linked list to achieve the same function.</p>
<h3 id="O-1"><a href="#O-1" class="headerlink" title="O(1)"></a>O(1)</h3><p>If we reconstruct the LRUCache with a map and a bunch of nodes, we can implement the LRUCache with O(1).(Since we need to get the value by key, so it has to be a hashtable)</p>
<p>Why? Since we can save the key and value in the node, and save all key-node pairs in the hashtable, and now we can get the value by key using hashtable, and we also have a list of nodes with order of last used time and the update on a linked list can be O(1).</p>
<p>Here is the code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Illustration of the design:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *       entry             entry             entry             entry</span></span><br><span class="line"><span class="comment"> *       ______            ______            ______            ______</span></span><br><span class="line"><span class="comment"> *      | tail |.newer =&gt; |      |.newer =&gt; |      |.newer =&gt; | head |</span></span><br><span class="line"><span class="comment"> *      |  A   |          |  B   |          |  C   |          |  D   |</span></span><br><span class="line"><span class="comment"> *      |______| &lt;= older.|______| &lt;= older.|______| &lt;= older.|______|</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> LRUCache = <span class="function"><span class="keyword">function</span>(<span class="params">capacity</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.capacity = capacity</span><br><span class="line">  <span class="keyword">this</span>.length = <span class="number">0</span></span><br><span class="line">  <span class="keyword">this</span>.map = &#123;&#125;</span><br><span class="line">  <span class="comment">// save the head and tail so we can update it easily</span></span><br><span class="line">  <span class="keyword">this</span>.head = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">this</span>.tail = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRUCache.prototype.node = <span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.key = key</span><br><span class="line">  <span class="keyword">this</span>.val = value</span><br><span class="line">  <span class="keyword">this</span>.newer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">this</span>.older = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRUCache.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.map.hasOwnProperty(key))&#123;</span><br><span class="line">    <span class="keyword">this</span>.updateKey(key)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.map[key].val</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">LRUCache.prototype.updateKey = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> node = <span class="keyword">this</span>.map[key]</span><br><span class="line">  <span class="comment">// break the chain and reconnect with newer and older</span></span><br><span class="line">  <span class="keyword">if</span>(node.newer)&#123;</span><br><span class="line">    node.newer.older= node.older</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.head = node.older</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(node.older)&#123;</span><br><span class="line">    node.older.newer = node.newer</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tail = node.newer</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// replace the node into head - newest</span></span><br><span class="line">  node.older = <span class="keyword">this</span>.head</span><br><span class="line">  node.newer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.head)&#123;</span><br><span class="line">    <span class="keyword">this</span>.head.newer = node</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.head = node</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if no items in the bucket, set the tail to node too.</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">this</span>.tail)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tail = node</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRUCache.prototype.set = <span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> node = <span class="keyword">new</span> <span class="keyword">this</span>.node(key,value)</span><br><span class="line">  <span class="comment">// update the value for exist entries</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.map.hasOwnProperty(key))&#123;</span><br><span class="line">    <span class="keyword">this</span>.map[key].val = value</span><br><span class="line">    <span class="keyword">this</span>.updateKey(key)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.length &gt;= <span class="keyword">this</span>.capacity)&#123;</span><br><span class="line">    <span class="comment">// remove the least recently used item</span></span><br><span class="line">    <span class="keyword">var</span> dKey = <span class="keyword">this</span>.tail.key</span><br><span class="line">    <span class="keyword">this</span>.tail = <span class="keyword">this</span>.tail.newer</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.tail)&#123;</span><br><span class="line">      <span class="keyword">this</span>.tail.older = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.map[dKey]</span><br><span class="line">    <span class="keyword">this</span>.length --</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// insert node into the head</span></span><br><span class="line">  node.older = <span class="keyword">this</span>.head</span><br><span class="line">  <span class="comment">// if have head, we need re-connect node with other nodes older than head</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.head)&#123;</span><br><span class="line">    <span class="keyword">this</span>.head.newer = node</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.head = node</span><br><span class="line">  <span class="comment">// if no tail which means first insert, set the tail to node too</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">this</span>.tail)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tail = node</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.map[key] = node</span><br><span class="line">  <span class="keyword">this</span>.length ++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can achieve set, get both with O(1).</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Here is some other implementations from others, if you are interested in it, check it yourself.</p>
<ul>
<li><a href="http://chrisrng.svbtle.com/lru-cache-in-javascript" target="_blank" rel="noopener">LRU by Chrisr NG</a></li>
<li><a href="https://github.com/rsms/js-lru/blob/master/lru.js" target="_blank" rel="noopener">LRU by rsms</a></li>
</ul>
</div><div class="post-info"><span class="category"><i class="fas fa-briefcase"></i><a href="/blog/categories/tech">tech</a></span><span class="tags"><i class="fas fa-tags"></i><a href="/blog/tags/JS">JS</a><a href="/blog/tags/LRU">LRU</a></span></div></section><div class="widgets"><aside id="menuIndex" class="sidenav hidden"></aside><aside class="sidenav"><input type="text" placeholder="Enter to search" class="st-default-search-input searchbox"></aside><aside class="sidenav series"><h2>In Serie: Implement in JS<i class="fas fa-arrow-down expand"></i><i class="collapse fas fa-arrow-up"></i></h2><ul class="article-list hidden"><li><a href="/blog/2015/11/03/tech-javascript-lru-cache/" data-id='0' class="current">Implement LRU Cache in JavaScript</a></li></ul></aside><aside class="sidenav"><div class="recent-posts"><h2>Recent Posts:</h2><ul class="article-list"><li><a href="/blog/2020/07/06/thoughts-recommendation-to-new-grads-on-job-choices/">给新计算机毕业生在工作选择上的一些建议</a></li><li><a href="/blog/2020/07/04/travel-working-holiday-visa-3/">打工度假 (三)</a></li><li><a href="/blog/2020/07/02/travel-working-holiday-visa-2/">打工度假 (二)</a></li><li><a href="/blog/2020/07/02/tech-what-i-have-done-to-restart-this-blog/">我都做了哪些来复活本博客的</a></li><li><a href="/blog/2020/07/01/travel-working-holiday-visa/">打工度假 (一)</a></li></ul></div></aside></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script><div class="comments"><script>const gitment = new Gitment({
  id: new Date('Tue Nov 03 2015 00:00:00 GMT-0500').toISOString(),
  owner: 'taoalpha',
  repo: 'blog',
  oauth: {
    client_id: '875872ffb3955d0ffe20',
    client_secret: '46040668c536860a9e2e9a8508c513309e3840b5',
  },
});
gitment.render(document.querySelector('.comments'));
</script></div></article><div class="notification fail hidden"></div><!-- jquery--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46725017-2",'auto');ga('send','pageview');</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','CUMLELEvkSRAFuVehSCm','2.0.0');</script><!-- main functions--><script src="/blog/js/functions.js"></script><script src="/blog/js/default.js"></script><script src="/blog/js/post.js"></script></body></html>