<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Related Articles and generate API files in Hexo | TaoAlpha's Blog</title><meta name="description" content="How to add related articles section and generate JSON files as static `API` to your hexo blog."><meta name="viewport" content="width=device-width, initial-scale=1"><!-- open graph part--><meta property="og:title" content="Related Articles and generate API files in Hexo | TaoAlpha's Blog"><meta property="og:description" content="How to add related articles section and generate JSON files as static `API` to your hexo blog."><meta property="og:url" content="undefined"><meta property="og:image" content="http://taoalpha.github.io/images/newblog.jpg"><meta property="og:type" content="website"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.6.0/hint.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"><link rel="short icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/default.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="TaoAlpha's Blog" type="application/atom+xml">
<link rel="alternate" href="/blog/rss2.xml" title="TaoAlpha's Blog" type="application/rss+xml">
</head><body class="post"><aside class="home-menu"><nav class="home-icon-con upside"><a href="/blog/" class="home-menu-icon brand">涛</a><a href="/blog/timeline" class="home-menu-icon"><i class="fas fa-map-marker-alt"></i></a><a aria-label="Click to take you to the search box." class="home-menu-icon search-trigger hint--right"><i class="fas fa-search"></i></a><a href="javascript:;" title="Contact Me" class="home-menu-icon follow">+</a><div class="home-contact hidden"><a href="https://facebook.com/zzgary/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/facebook-32.png" alt="facebook"></a><a href="https://github.com/taoalpha/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/github-32.png" alt="github"></a><a href="https://taoalpha.github.io" target="something"><img src="https://cdn3.iconfinder.com/data/icons/colore-sociale/32/mewally_32x32.png" alt="portfolio"></a><a href="https://douban.com/people/129154019" target="something"><img src="https://img3.doubanio.com/favicon.ico" alt="douban"></a></div></nav><nav class="home-icon-con downside"><a href="/blog/rss2.xml" class="home-menu-icon rss"><i class="fas fa-rss"></i></a><a href="/blog/about/" class="home-menu-icon"><i class="fas fa-smile"></i></a><span id="dark-mode" class="home-menu-icon hidden"><i class="fas fa-adjust"></i></span></nav></aside><div class="stars"></div><div class="twinkling"></div><div id="progress-bar" class="hidden"><span class="bg"></span></div><article id="content"><div class="main"><section class="entry"><h1 class="entry-title">Related Articles and generate API files in Hexo</h1><div class="meta-top"><a href="https://taoalpha.github.io"><div style="display:inline-block;" class="avatar"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&amp;s=40" alt="100"></div><span>TaoAlpha</span></a><span>2015-12-27</span><span class="wordage">5522 words</span><span class="readspeed">16 minutes to read</span></div><div class="entry-content"><h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><p>Since I have migrated my entire blog to hexo, so I need to rewrite a lot modules :) Today we talk about related articles and how to generate api files in your hexo blog.</p>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><h3 id="Related-Articles"><a href="#Related-Articles" class="headerlink" title="Related Articles"></a>Related Articles</h3><p>Unlike jekyll, hexo doesn’t have a built-in module to populate the related articles (meanwhile, jekyll’s built-in related articles are sucks, so many people build themselves, I did once before, you can check this Optimize jekyll(in chinese) if you want.), so I have to write one for myself.</p>
<p>The idea is pretty simple and similiar with last one I did for jekyll, use the tag to compare different posts, it they have some common tags, they should be similiar, or related.</p>
<p>So I query the post according to current post’s category and get all posts with same category as current one, then for each post, I compared its tags with current post’s, if there is some intersect between them, I will count it as a related article to current post.</p>
<p>The code is simple too(written in jade):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- var posts &#x3D; []</span><br><span class="line">- if(page.categories)&#123;</span><br><span class="line">-   var cat &#x3D; page.categories.toArray()[0].name</span><br><span class="line">-   var existTags &#x3D; page.tags.toArray().map(function(v)&#123;return v.name&#125;)</span><br><span class="line">-   var prePosts &#x3D; site.categories.findOne(&#123;name: cat&#125;).posts</span><br><span class="line">-   if(prePosts.toArray().length&gt;0)&#123;</span><br><span class="line">-     var someCatPosts &#x3D; prePosts.sort(&#39;date&#39;, -1).toArray()</span><br><span class="line">-     someCatPosts.forEach(function(v)&#123;</span><br><span class="line">-       var tags &#x3D; v.tags.toArray().map(function(t)&#123;return t.name&#125;).filter(function(n)&#123;return existTags.indexOf(n)!&#x3D;-1&#125;)</span><br><span class="line">-       if(tags.length&gt;0 &amp;&amp; posts.length &lt; 5 &amp;&amp; v.permalink !&#x3D; page.permalink)&#123;</span><br><span class="line">-         posts.push(v)</span><br><span class="line">-       &#125;</span><br><span class="line">-     &#125;)</span><br><span class="line">-   &#125;</span><br><span class="line">- &#125;</span><br><span class="line">if posts.length &gt; 0</span><br><span class="line">  div.relatedposts.sidenav</span><br><span class="line">    h2&#x3D; &quot;Related Posts:&quot;</span><br><span class="line">    ul.article-list</span><br><span class="line">      each post in posts</span><br><span class="line">        li</span><br><span class="line">          a(href&#x3D;url_for(post.permalink))&#x3D; post.title</span><br></pre></td></tr></table></figure>

<h3 id="API-Generator"><a href="#API-Generator" class="headerlink" title="API Generator"></a>API Generator</h3><p>Since I use static blog, I don’t have any tools or modules like php to deal with post and get request, but what I can do is I can host json files with data I want to put in and treat it as a API(since most API just return a json with proper content), like I have latest.json to show the latest 10 posts of my blog, you can view it through this link.</p>
<p>Yup. This is the basic idea, and how to do it? We need build a plugin for hexo :)</p>
<p>A plugin for hexo is a normal module for node, so you need to define the package.json and the index.js, its totally fine that you only have one js file if you don’t need to deal with complicated logic things. But this time, I use two js files, the index.js would load the config from the hexo and assing the task to different generators. :)</p>
<p>And this is modified from the source code of hexo-generator-sitemap :)</p>
<p>Since they are using pretty much the same logic, I just remove the built-in modules: sitemap and feed generator, and combine them into one.</p>
<p>Here it is:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this is the index.js</span></span><br><span class="line"><span class="keyword">var</span> merge = <span class="built_in">require</span>(<span class="string">'utils-merge'</span>);</span><br><span class="line"><span class="keyword">var</span> pathFn = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// load the config from the hexo.config and combine them with some default configurations</span></span><br><span class="line"><span class="keyword">var</span> config = hexo.config.api = merge(&#123;</span><br><span class="line">  sitemap:&#123;</span><br><span class="line">    src: <span class="string">"sitemap.jade"</span>,</span><br><span class="line">    desc: <span class="string">"sitemap"</span>,</span><br><span class="line">    path: <span class="string">"sitemap.xml"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  feed:&#123;</span><br><span class="line">    src: <span class="string">"feed.jade"</span>,</span><br><span class="line">    desc: <span class="string">"feed"</span>,</span><br><span class="line">    path: <span class="string">"feed.xml"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, hexo.config.api);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gen = <span class="built_in">require</span>(<span class="string">'./lib/generator'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign them to different generators</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> item <span class="keyword">in</span> config)&#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;hexo.extend.generator.register(item, <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gen(item,hexo.config,locals)</span><br><span class="line">  &#125;)</span><br><span class="line">  &#125;)(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this is the ./lib/generator.js</span></span><br><span class="line"><span class="keyword">var</span> jade = <span class="built_in">require</span>(<span class="string">'jade'</span>);</span><br><span class="line"><span class="keyword">var</span> pathFn = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main functions, current only deal with the latest posts if it is a json file task :)</span></span><br><span class="line"><span class="comment">// if it is xml task, then it will render the default template ( sitemap.jade, feed.jade)</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">item,config,locals</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> api = config.api</span><br><span class="line">  <span class="keyword">if</span>(api[item].path.endsWith(<span class="string">"json"</span>))&#123;</span><br><span class="line">    <span class="keyword">var</span> posts = locals.posts.toArray()</span><br><span class="line">      .sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.updated - a.updated;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="keyword">var</span> data = [],count = <span class="number">0</span></span><br><span class="line">    posts.forEach( <span class="function">(<span class="params">post</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(count &gt; (api[item].limit || <span class="number">10</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> temp = &#123;&#125;</span><br><span class="line">      post.date = <span class="keyword">new</span> <span class="built_in">Date</span>(post.date).toLocaleDateString()</span><br><span class="line">      api[item].attr.forEach( <span class="function">(<span class="params">v</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(v == <span class="string">"summary"</span>)&#123;</span><br><span class="line">          temp[v] = post.content.replace(<span class="regexp">/(&lt;([^&gt;]+)&gt;)/ig</span>,<span class="string">''</span>).slice(<span class="number">0</span>,<span class="number">200</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          temp[v] = post[v]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      count ++</span><br><span class="line">      data.push(temp)</span><br><span class="line">    &#125;)</span><br><span class="line">    data = <span class="built_in">JSON</span>.stringify(data)</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// for xml(now only support sitemap, feed since I only these two templates :)</span></span><br><span class="line">    <span class="keyword">var</span> templateSrc= pathFn.join(__dirname, <span class="string">'../'</span>+api[item].src);</span><br><span class="line">    <span class="keyword">var</span> tmpl = jade.compile(fs.readFileSync(templateSrc, <span class="string">'utf8'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> posts = [].concat(locals.posts.toArray(), locals.pages.toArray())</span><br><span class="line">      .filter(<span class="function"><span class="keyword">function</span>(<span class="params">post</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> post.sitemap !== <span class="literal">false</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.updated - a.updated;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data= tmpl(&#123;</span><br><span class="line">      config: config,</span><br><span class="line">      posts: posts</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    path: api[item].path,</span><br><span class="line">    data: data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That’s it.</p>
<p>I love hexo!! I love JS!!! :)</p>
</div><div class="post-info"><span class="category"><i class="fas fa-briefcase"></i><a href="/blog/categories/tech">tech</a></span><span class="tags"><i class="fas fa-tags"></i><a href="/blog/tags/JS">JS</a></span></div></section><div class="widgets"><aside id="menuIndex" class="sidenav hidden"></aside><aside class="sidenav"><input type="text" placeholder="Enter to search" class="st-default-search-input searchbox"></aside><div class="related-posts sidenav"><h2>Related Posts:</h2><ul class="article-list"><li><a href="/blog/2015/12/07/tech-my-first-cli-tool-with-nodejs/">First CLI tool with NodeJS</a></li><li><a href="/blog/2015/11/19/tech-preventDefault-and-stopPropagation-in-JS/">preventDefault and stopPropagation in JS</a></li><li><a href="/blog/2015/11/11/tech-use-strict-in-js/">Strict Mode in JavaScript</a></li><li><a href="/blog/2015/11/06/tech-es6-general-summary/">ES6 General Summary</a></li><li><a href="/blog/2015/11/03/tech-javascript-lru-cache/">Implement LRU Cache in JavaScript</a></li></ul></div><aside class="sidenav"><div class="recent-posts"><h2>Recent Posts:</h2><ul class="article-list"><li><a href="/blog/2020/07/06/thoughts-recommendation-to-new-grads-on-job-choices/">给新计算机毕业生在工作选择上的一些建议</a></li><li><a href="/blog/2020/07/04/travel-working-holiday-visa-3/">打工度假 (三)</a></li><li><a href="/blog/2020/07/02/travel-working-holiday-visa-2/">打工度假 (二)</a></li><li><a href="/blog/2020/07/02/tech-what-i-have-done-to-restart-this-blog/">我都做了哪些来复活本博客的</a></li><li><a href="/blog/2020/07/01/travel-working-holiday-visa/">打工度假 (一)</a></li></ul></div></aside></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script><div class="comments"><script>const gitment = new Gitment({
  id: new Date('Sun Dec 27 2015 09:00:00 GMT-0500').toISOString(),
  owner: 'taoalpha',
  repo: 'blog',
  oauth: {
    client_id: '875872ffb3955d0ffe20',
    client_secret: '46040668c536860a9e2e9a8508c513309e3840b5',
  },
});
gitment.render(document.querySelector('.comments'));
</script></div></article><div class="notification fail hidden"></div><!-- jquery--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46725017-2",'auto');ga('send','pageview');</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','CUMLELEvkSRAFuVehSCm','2.0.0');</script><!-- main functions--><script src="/blog/js/functions.js"></script><script src="/blog/js/default.js"></script><script src="/blog/js/post.js"></script></body></html>