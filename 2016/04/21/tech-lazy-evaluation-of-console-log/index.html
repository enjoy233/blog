<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Lazy Evaluation of console.log | TaoAlpha's Blog</title><meta name="description" content="Lazy Evaluation of console.log"><meta name="viewport" content="width=device-width, initial-scale=1"><!-- open graph part--><meta property="og:title" content="Lazy Evaluation of console.log | TaoAlpha's Blog"><meta property="og:description" content="Lazy Evaluation of console.log"><meta property="og:url" content="undefined"><meta property="og:image" content="http://taoalpha.github.io/images/newblog.jpg"><meta property="og:type" content="website"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.6.0/hint.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"><link rel="short icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/default.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="TaoAlpha's Blog" type="application/atom+xml">
<link rel="alternate" href="/blog/rss2.xml" title="TaoAlpha's Blog" type="application/rss+xml">
</head><body class="post"><aside class="home-menu"><nav class="home-icon-con upside"><a href="/blog/" class="home-menu-icon brand">涛</a><a href="/blog/timeline" class="home-menu-icon"><i class="fas fa-map-marker-alt"></i></a><a aria-label="Click to take you to the search box." class="home-menu-icon search-trigger hint--right"><i class="fas fa-search"></i></a><a href="javascript:;" title="Contact Me" class="home-menu-icon follow">+</a><div class="home-contact hidden"><a href="https://facebook.com/zzgary/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/facebook-32.png" alt="facebook"></a><a href="https://github.com/taoalpha/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/github-32.png" alt="github"></a><a href="https://taoalpha.github.io" target="something"><img src="https://cdn3.iconfinder.com/data/icons/colore-sociale/32/mewally_32x32.png" alt="portfolio"></a><a href="https://douban.com/people/129154019" target="something"><img src="https://img3.doubanio.com/favicon.ico" alt="douban"></a></div></nav><nav class="home-icon-con downside"><a href="/blog/rss2.xml" class="home-menu-icon rss"><i class="fas fa-rss"></i></a><a href="/blog/about/" class="home-menu-icon"><i class="fas fa-smile"></i></a><span id="dark-mode" class="home-menu-icon hidden"><i class="fas fa-adjust"></i></span></nav></aside><div class="stars"></div><div class="twinkling"></div><div id="progress-bar" class="hidden"><span class="bg"></span></div><article id="content"><div class="main"><section class="entry"><h1 class="entry-title">Lazy Evaluation of console.log</h1><div class="meta-top"><a href="https://taoalpha.github.io"><div style="display:inline-block;" class="avatar"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&amp;s=40" alt="100"></div><span>TaoAlpha</span></a><span>2016-04-21</span><span class="wordage">2600 words</span><span class="readspeed">8 minutes to read</span></div><div class="entry-content"><h2 id="Story"><a href="#Story" class="headerlink" title="Story"></a>Story</h2><p>Yesterday, I got a question from a friend who asked me to review his code and explain why the object he printed out got changed before he actually modifies it. This is a classic ‘asynchronous’ or lazy evaluation(more accuarately) problem of console.log().</p>
<p>We all know that console.log is the most popular and common way to debug your javascript code since it is easy to use and easy to see the output, your eyes can not fool you, right ?</p>
<p>No, sometimes, your eyes will fool you, especially when we talk about the lazy evaluation.</p>
<h2 id="Test-and-Explain"><a href="#Test-and-Explain" class="headerlink" title="Test and Explain"></a>Test and Explain</h2><p>Lets see some examples:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// under chrome 49.0</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj.a = <span class="string">"hello"</span></span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br><span class="line">obj[<span class="string">"foo"</span>] = <span class="string">"bar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* output without "foo"</span></span><br><span class="line"><span class="comment">&#123; a: 'hello' &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj.a = <span class="string">"hello"</span></span><br><span class="line">obj.b = []</span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br><span class="line">obj[<span class="string">"foo"</span>] = <span class="string">"bar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* output with "foo"</span></span><br><span class="line"><span class="comment">&#123; a: 'hello', b: [], foo: 'bar' &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Why !?</p>
<p>The main reason is because the console.log has different behaviors in two platforms. Although the the asynchronous or synchorouns of console.log depends on the platforms, but normally when you call console.log, your arguments are always referenced and computed right away, but the display or render process is definitely asynchronous, so it needs to find a place to store the data. Either the console clone the the mutable objects that you did log, or it will store a reference to them. But for complicated objects, the first method would not work properly since it will take time and memory, so for complicated objects, the console will store a reference to them. And the time you see the result of rendering, you always see the current state of the object, but the current state maybe not be the state that you call the console.log function.</p>
<p>So how to avoid this ‘mistake’ ? Here are several ways:</p>
<ul>
<li>Use nodeJS.<br>The Console class holds all methods and api for simulating the console in browsers and console functions are asynchronous unless the destination is a file. But maybe because it don’t need to render (just output to the stream), so things like above will not appear in Node.</li>
<li>Use stringify before logging.<br>This would work for not so deep objects, since it will force console to store the data instead of reference.<br>Here is the same code running under Node.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// under node 5.1.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj.a = <span class="string">"hello"</span></span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br><span class="line">obj[<span class="string">"foo"</span>] = <span class="string">"bar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* output without "foo"</span></span><br><span class="line"><span class="comment">&#123; a: 'hello' &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj.a = <span class="string">"hello"</span></span><br><span class="line">obj.b = []</span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br><span class="line">obj[<span class="string">"foo"</span>] = <span class="string">"bar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* output without "foo"</span></span><br><span class="line"><span class="comment">&#123; a: 'hello', b: [] &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>Cool ?! :) Have a great day!</p>
</div><div class="post-info"><span class="category"><i class="fas fa-briefcase"></i><a href="/blog/categories/tech">tech</a></span><span class="tags"><i class="fas fa-tags"></i><a href="/blog/tags/js">js</a></span></div></section><div class="widgets"><aside id="menuIndex" class="sidenav hidden"></aside><aside class="sidenav"><input type="text" placeholder="Enter to search" class="st-default-search-input searchbox"></aside><aside class="sidenav series"><h2>In Serie: The way I learn JS<i class="fas fa-arrow-down expand"></i><i class="collapse fas fa-arrow-up"></i></h2><ul class="article-list hidden"><li><a href="/blog/2016/04/17/tech-apply-and-call-in-javascript/" data-id='0'>apply and call in JS</a></li><li><a href="/blog/2016/04/21/tech-lazy-evaluation-of-console-log/" data-id='1' class="current">Lazy Evaluation of console.log</a></li><li><a href="/blog/2016/04/28/tech-symbol-and-iterate-object-in-es6/" data-id='2'>Symbol and Iterate Object in ES6</a></li><li><a href="/blog/2016/04/29/tech-defineproperty-in-javascript/" data-id='3'>defineProperty in JavaScript</a></li><li><a href="/blog/2016/06/17/tech-javascript-module-system/" data-id='4'>Javascript Module Standard</a></li><li><a href="/blog/2016/08/13/tech-deep-copy-in-javascript/" data-id='5'>Deep copy in javascript</a></li></ul></aside><aside class="sidenav"><div class="recent-posts"><h2>Recent Posts:</h2><ul class="article-list"><li><a href="/blog/2020/07/06/thoughts-recommendation-to-new-grads-on-job-choices/">给新计算机毕业生在工作选择上的一些建议</a></li><li><a href="/blog/2020/07/04/travel-working-holiday-visa-3/">打工度假 (三)</a></li><li><a href="/blog/2020/07/02/travel-working-holiday-visa-2/">打工度假 (二)</a></li><li><a href="/blog/2020/07/02/tech-what-i-have-done-to-restart-this-blog/">我都做了哪些来复活本博客的</a></li><li><a href="/blog/2020/07/01/travel-working-holiday-visa/">打工度假 (一)</a></li></ul></div></aside></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script><div class="comments"><script>const gitment = new Gitment({
  id: new Date('Thu Apr 21 2016 07:00:00 GMT-0400').toISOString(),
  owner: 'taoalpha',
  repo: 'blog',
  oauth: {
    client_id: '875872ffb3955d0ffe20',
    client_secret: '46040668c536860a9e2e9a8508c513309e3840b5',
  },
});
gitment.render(document.querySelector('.comments'));
</script></div></article><div class="notification fail hidden"></div><!-- jquery--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46725017-2",'auto');ga('send','pageview');</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','CUMLELEvkSRAFuVehSCm','2.0.0');</script><!-- main functions--><script src="/blog/js/functions.js"></script><script src="/blog/js/default.js"></script><script src="/blog/js/post.js"></script></body></html>