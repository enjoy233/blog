<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Deep copy in javascript | TaoAlpha's Blog</title><meta name="description" content="how to implement deep copy in js."><meta name="viewport" content="width=device-width, initial-scale=1"><!-- open graph part--><meta property="og:title" content="Deep copy in javascript | TaoAlpha's Blog"><meta property="og:description" content="how to implement deep copy in js."><meta property="og:url" content="undefined"><meta property="og:image" content="http://taoalpha.github.io/images/newblog.jpg"><meta property="og:type" content="website"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.6.0/hint.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"><link rel="short icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/default.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="TaoAlpha's Blog" type="application/atom+xml">
<link rel="alternate" href="/blog/rss2.xml" title="TaoAlpha's Blog" type="application/rss+xml">
</head><body class="post"><aside class="home-menu"><nav class="home-icon-con upside"><a href="/blog/" class="home-menu-icon brand">涛</a><a href="/blog/timeline" class="home-menu-icon"><i class="fas fa-map-marker-alt"></i></a><a aria-label="Click to take you to the search box." class="home-menu-icon search-trigger hint--right"><i class="fas fa-search"></i></a><a href="javascript:;" title="Contact Me" class="home-menu-icon follow">+</a><div class="home-contact hidden"><a href="https://facebook.com/zzgary/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/facebook-32.png" alt="facebook"></a><a href="https://github.com/taoalpha/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/github-32.png" alt="github"></a><a href="https://taoalpha.github.io" target="something"><img src="https://cdn3.iconfinder.com/data/icons/colore-sociale/32/mewally_32x32.png" alt="portfolio"></a><a href="https://douban.com/people/129154019" target="something"><img src="https://img3.doubanio.com/favicon.ico" alt="douban"></a></div></nav><nav class="home-icon-con downside"><a href="/blog/rss2.xml" class="home-menu-icon rss"><i class="fas fa-rss"></i></a><a href="/blog/about/" class="home-menu-icon"><i class="fas fa-smile"></i></a><span id="dark-mode" class="home-menu-icon hidden"><i class="fas fa-adjust"></i></span></nav></aside><div class="stars"></div><div class="twinkling"></div><div id="progress-bar" class="hidden"><span class="bg"></span></div><article id="content"><div class="main"><section class="entry"><h1 class="entry-title">Deep copy in javascript</h1><div class="meta-top"><a href="https://taoalpha.github.io"><div style="display:inline-block;" class="avatar"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&amp;s=40" alt="100"></div><span>TaoAlpha</span></a><span>2016-08-13</span><span class="wordage">2995 words</span><span class="readspeed">9 minutes to read</span></div><div class="entry-content"><h2 id="Deep-Copy-vs-Reference-Copy"><a href="#Deep-Copy-vs-Reference-Copy" class="headerlink" title="Deep Copy vs Reference Copy"></a>Deep Copy vs Reference Copy</h2><p>In javascript, everytime you use = or pass a primitive to a function, you are doing deep copy, since whatever happends to it will never affect the origin one.</p>
<p>But things will be so different on objects:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// deep copy on primitives</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">b = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b, a); <span class="comment">// 1, "hello"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123; a = <span class="number">1</span> &#125;;</span><br><span class="line">foo(a);</span><br><span class="line"><span class="built_in">console</span>.log(a);  <span class="comment">// "hello"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reference copy on objects</span></span><br><span class="line"><span class="keyword">let</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> e = c;</span><br><span class="line">e[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// [2, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a</span>) </span>&#123; a[<span class="number">0</span>] = <span class="number">3</span> &#125;;</span><br><span class="line">bar(c);</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// [3, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>Since objects passing by reference, so any changes on them will affect the actual data, so will be reflected to the origin ones.</p>
<h2 id="Deep-Copy-on-Objects"><a href="#Deep-Copy-on-Objects" class="headerlink" title="Deep Copy on Objects"></a>Deep Copy on Objects</h2><p>Most times, reference copy makes life easier. But sometimes, you actually need a deep copy of an object, then you may find several methods in this post :)</p>
<h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign"></a>Object.assign</h3><p>Object.assign is introduced by ES2015, now is supported by most modern browsers, of course, IE not included… but you can find a really handy polyfill for it from this link.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// deep copy with Object.assign</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;<span class="attr">a</span>: <span class="string">"a"</span>, <span class="attr">b</span>: <span class="string">"b"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// have to use &#123;&#125; as the target, since you need a whole new copy</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// &#123;a: "a", b: "b"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b == a); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>Of course, you can use Object.assign do a lot more than deep copy an object, but at least when you want to get some deep copies, this would be one of the easies way to do it.</p>
<h3 id="JSON-parse-and-JSON-stringify"><a href="#JSON-parse-and-JSON-stringify" class="headerlink" title="JSON.parse and JSON.stringify"></a>JSON.parse and JSON.stringify</h3><p>Considering Object.assign is not supported by ALL browsers, you may not want to use it. Then try JSON way:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// deep copy with JSON.parse and JSON.stringify</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;<span class="attr">a</span>: <span class="string">"a"</span>, <span class="attr">b</span>: <span class="string">"b"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use stringify to convert the object to a string(primitive) and parse the string to a new object</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(a));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// &#123;a: "a", b: "b"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b == a); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>Cool, ha? But there is one condition that will give you error: <strong>CIRCULAR OBJECTS</strong>.</p>
<p>JSON.stringify can not convert circular objects to string, so it will break and thorw an error.</p>
<p>It does work on circular objects with Object.assign :)</p>
<h3 id="slice-and-concat-on-arrays"><a href="#slice-and-concat-on-arrays" class="headerlink" title="slice and concat on arrays"></a>slice and concat on arrays</h3><p>If you want to deep copies on arrays, then you have two wonderful methods to use:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// deep copy with slice</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// slice(0) will return you an new array with nothing sliced in origin one</span></span><br><span class="line"><span class="keyword">let</span> b = a.slice(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b);  <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"><span class="built_in">console</span>.log(b == a);  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// concat() will return you an new array with nothing to caoncat with</span></span><br><span class="line"><span class="keyword">let</span> c = a.concat();</span><br><span class="line"><span class="built_in">console</span>.log(c);  <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"><span class="built_in">console</span>.log(c == a);  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>The reason behind these two methods is because they both return new arrays instead of modifying origin ones.</p>
<h3 id="Customized-deep-copy-methods"><a href="#Customized-deep-copy-methods" class="headerlink" title="Customized deep copy methods"></a>Customized deep copy methods</h3><p>Of course you can implement your own deep copy helper functions, actually several popular libs like jQuery, backbone, underscore, all have their own clone or extend methods to help you do deep copy.</p>
</div><div class="post-info"><span class="category"><i class="fas fa-briefcase"></i><a href="/blog/categories/tech">tech</a></span><span class="tags"><i class="fas fa-tags"></i><a href="/blog/tags/js">js</a><a href="/blog/tags/copy">copy</a></span></div></section><div class="widgets"><aside id="menuIndex" class="sidenav hidden"></aside><aside class="sidenav"><input type="text" placeholder="Enter to search" class="st-default-search-input searchbox"></aside><aside class="sidenav series"><h2>In Serie: The way I learn JS<i class="fas fa-arrow-down expand"></i><i class="collapse fas fa-arrow-up"></i></h2><ul class="article-list hidden"><li><a href="/blog/2016/04/17/tech-apply-and-call-in-javascript/" data-id='0'>apply and call in JS</a></li><li><a href="/blog/2016/04/21/tech-lazy-evaluation-of-console-log/" data-id='1'>Lazy Evaluation of console.log</a></li><li><a href="/blog/2016/04/28/tech-symbol-and-iterate-object-in-es6/" data-id='2'>Symbol and Iterate Object in ES6</a></li><li><a href="/blog/2016/04/29/tech-defineproperty-in-javascript/" data-id='3'>defineProperty in JavaScript</a></li><li><a href="/blog/2016/06/17/tech-javascript-module-system/" data-id='4'>Javascript Module Standard</a></li><li><a href="/blog/2016/08/13/tech-deep-copy-in-javascript/" data-id='5' class="current">Deep copy in javascript</a></li></ul></aside><aside class="sidenav"><div class="recent-posts"><h2>Recent Posts:</h2><ul class="article-list"><li><a href="/blog/2020/07/06/thoughts-recommendation-to-new-grads-on-job-choices/">给新计算机毕业生在工作选择上的一些建议</a></li><li><a href="/blog/2020/07/04/travel-working-holiday-visa-3/">打工度假 (三)</a></li><li><a href="/blog/2020/07/02/travel-working-holiday-visa-2/">打工度假 (二)</a></li><li><a href="/blog/2020/07/02/tech-what-i-have-done-to-restart-this-blog/">我都做了哪些来复活本博客的</a></li><li><a href="/blog/2020/07/01/travel-working-holiday-visa/">打工度假 (一)</a></li></ul></div></aside></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script><div class="comments"><script>const gitment = new Gitment({
  id: new Date('Sat Aug 13 2016 07:00:00 GMT-0400').toISOString(),
  owner: 'taoalpha',
  repo: 'blog',
  oauth: {
    client_id: '875872ffb3955d0ffe20',
    client_secret: '46040668c536860a9e2e9a8508c513309e3840b5',
  },
});
gitment.render(document.querySelector('.comments'));
</script></div></article><div class="notification fail hidden"></div><!-- jquery--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46725017-2",'auto');ga('send','pageview');</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','CUMLELEvkSRAFuVehSCm','2.0.0');</script><!-- main functions--><script src="/blog/js/functions.js"></script><script src="/blog/js/default.js"></script><script src="/blog/js/post.js"></script></body></html>